function getCookie(t){for(var e,i,s=document.cookie.split(";"),n=0;n<s.length;n++)if(e=s[n].substr(0,s[n].indexOf("=")),i=s[n].substr(s[n].indexOf("=")+1),e=e.replace(/^\s+|\s+$/g,""),e===t)return decodeURIComponent(i)}function setCookie(t,e,i){i?i%=99983489:i=99983488
var s=new Date
s.setDate(s.getDate()+i)
var n=encodeURIComponent(e)+(null===i?"":"; expires = "+s.toUTCString())
document.cookie=t+"="+n}function rmCookie(t){setCookie(t,"",-1)}function database(t,e,i,s,n,a){this.name=t||"Database",this.headerRow=isNon(e)?range(100):e,this.headerCol=s||["Index","Value"],this.content=isNon(i)?new Array(this.headerCol.length).fill("..."):i,this.admin=n||"Anonymous",this.version=a||1,this.val=new Array(this.headerRow.length)
for(var o=0;o<this.val.length;o++)this.val[o]=new Array(this.headerCol.length).fill(" ")
for(o=0;o<this.headerCol.length;o++)this.val[0][o]=this.headerCol[o]
for(o=0;o<this.content.length;o++){this.val[o][0]=this.headerRow?this.headerRow[o]:o
for(var r=0;r<this.content[o].length;r++)this.val[o][r+1]=this.content[o][r]}return this.setStorage=function(){localStorage[this.name]=JSON.stringify(this.val)},this.css="#"+this.name+"table{font-family:Consolas,Segoe UI,Tahoma,sans-serif;background: #000;}#"+this.name+"table,#"+this.name+"td,#"+this.name+"th{border:1px solid #000;color:#000;background:#fff;}#"+this.name+"tr:nth-child(even) td,#"+this.name+"tr:nth-child(even) th{background:#eee;}",this.html=complexTable(this.name,this.headerRow,this.content,this.headerCol,this.name,!1,this.css),this.disp=function(t){$e(t?"#"+t:"body").write(this.html,!0),this.setStorage()},this.update=function(){localStorage[this.name]?this.val=JSON.parse(localStorage[this.name]):this.setStorage(),this.html=complexTable(this.name,this.headerRow,this.content,this.headerCol,this.name,!1,this.css)},this.searchAndRemove=function(t){for(var e=0;e<t.length;e++)for(var i=0;i<this.val.length;i++)for(var s=0;s<this.val.length;s++)this.val[i][s]==t[e]&&(this.val[i][s]=null)},this.remove=function(t,e){for(var i=0;i<t.length;i++)for(var s=0;s<e.length;s++)this.val[e[s]][t[i]]=null},this.toString=function(){return"database(name="+this.name+", headerRow="+this.headerRow+", headerCol="+this.headerCol+", content="+this.content+", admin="+this.admin+", version="+this.version+")"},this}function DB(t,e,i,s){return this.name=t||"DB",this.head=e||["Index","Value"],this.val=i||[range(1),new Array(range(1).length).fill("...")].translate(),this.css="table#"+this.name+"{font-family:Consolas,Segoe UI,Tahoma,sans-serif;background: #000;}table#"+this.name+", #"+this.name+" td, #"+this.name+" th{border:1px solid #000;color:#000;background:#fff;}#"+this.name+" tr:nth-child(even) td,#"+this.name+" tr:nth-child(even) th{background:#eee;}",this.html="",this.rows=s||!1,this.onBuild=this.onFill=this.onSave=this.onUpdate=this.onSet=this.onGet=this.onFind=this.onSee=this.onView=this.onAdd=this.onInit=$f,this.build=function(){this.html=isNon(this.rows)?colTable("",this.head,this.val,this.name,!0,this.css):complexTable("",this.rows,this.val,this.head,this.name,!0,this.css),this.onBuild(this.html)},this.fill=function(t){this.val=[]
for(var e=0;e<t;e++)this.val[e]=[e].append(new Array(range(t-1||1).length).fill("..."))
return this.onFill(this.val,t),this.val},this.save=function(){localStorage[this.name]=JSON.stringify(this.val),localStorage[this.name+"_head"]=JSON.stringify(this.head),localStorage[this.name+"_html"]=this.html,localStorage[this.name+"_rows"]=this.rows,this.onSave(localStorage[this.name],localStorage[this.name+"_head"],localStorage[this.name+"_html"],localStorage[this.name+"_rows"])},this.update=function(){localStorage[this.name]?(this.val=JSON.parse(localStorage[this.name]),this.head=JSON.parse(localStorage[this.name+"_head"]),this.html=localStorage[this.name+"_html"],this.rows="false"==localStorage[this.name+"_rows"]?localStorage[this.name+"_rows"]:localStorage[this.name+"_rows"].split(",")):this.save(),this.onUpdate(this)},this.set=function(t,e,i){if(i===-1)for(var s=0;s<t.length;s++)this.val[e||0][s]=t[s]
else this.val[e||0][i||0]=t||null
this.onSet(t,[e,i])},this.get=function(t,e){return this.onGet(t,e),isNon(e)?this.val[t||0]:this.val[t||0][e]},this.find=function(t){var e=lookfor(t,this.val)
return this.onFind(t,e),e},this.see=function(){return this.onSee(Copy(this.val).prepend(Copy(this.head).reverse())),isNon(this.rows)?Copy(this.val).prepend([Copy(this.head)]):Copy(this.val).prepend(Copy(this.head).reverse())},this.view=function(t){this.build(),$e(t?"#"+t:"body").write(this.html,!0),this.onView($e(t?"#"+t:"body").val(!0),t)},this.add=function(t,e){this.val.push([parseFloat(this.val.last()[0])+(e||1)].concat(t)),this.onAdd(t,this.val)},this.init=function(t){this.build(),this.update(),t&&console.table(this.see()),this.onInit(this)},this.remove=function(t){return this.val[t||this.val.lastIndex()]=void 0,this.val.remove(),this.val},this.toString=function(){return"DB(name="+this.name+", head="+this.head+", val="+this.val+", rows="+this.rows+")"},this}function process(t,e,i,s,n){return this.name=t,this.author=e||"Anonymous",this.bitsize=0,this.description=i||"",this.content=s||"",this.sig=this.name[0]+this.name[this.name.length-1]+this.name.prod()+this.author.slice(0,2)+"-"+getType(this.content)[0],this.update=function(){this.author!=e||"Anonymous"===this.author||isNon(this.author)?this.sig=this.name[0]+this.name[this.name.length-1]+"-"+this.name.prod()+this.author.slice(0,2)+"-"+getType(this.content)[0]:this.sig=this.name[0]+this.name[this.name.length-1]+this.name.prod()+this.author.slice(0,2)+"-"+getType(this.content)[0],"N"===this.sig[this.sig.length-1]?this.bitsize=8*conv(this.content,10,2).sum():"B"===this.sig[this.sig.length-1]?this.bitsize=8:"A"===this.sig[this.sig.length-1]?this.bitsize=is2dArray(this.content)?8*this.content.numElm():8*this.content.length:"O"===this.sig[this.sig.length-1]?this.bitsize=0:"S"===this.sig[this.sig.length-1]?this.bitsize=8*this.content.length:this.bitsize=null},this.update(),this.askPermission=function(t){this.update(),t.add(this)},this.destroy=function(){Essence.say("The process named "+this.name+" (created by "+this.author+") has been destroyed !","info"),this.delete(),Essence.processList=Essence.processList.remove()},Essence.addProcess(this),this.run=n||$f,this}function server(t,e,i,s,n){if(this.name=t||"Server",this.admin=e||"",this.version=s||1,this.maxsize=n||Math.pow(2,14),this.nb_slots=Math.pow(2,6),this.slots=mkArray(this.nb_slots,1,"empty"),this.type=(i||"data").toLowerCase(),"data"===this.type)this.data=new DB("db_"+this.name,["Index","Value"],this.slots,range(1,1,this.maxsize))
else if("process"===this.type)this.data=new DB("db_"+this.name,["NÂ°","Name","Author","Description","Content","Bit size"],this.slots,range(1,1,this.maxsize))
else if("storage"===this.type)this.data=new DB("db_"+this.name,["Key","Value"],this.slots,range(1,1,this.maxsize))
else if("authentication"===this.type)this.data=new DB("db_"+this.name,["Username","Password","Email"],this.slots,range(1,1,this.maxsize))
else if("register"===this.type||"details"==this.type)this.data=new DB("db_"+this.name,["First name","Last Name","Title","Email","Phone","Sex","City/Country","Birthday","Websites","Job","Quote"],this.slots,range(1,1,this.maxsize))
else{if("location"!==this.type)throw new Error(this.type+" is an invalid server type.")
this.data=new DB("db_"+this.name,["Name","Longitude","Latitude"],this.slots,range(1,1,this.maxsize))}return this.addProcess=function(e){if(this.event=new Event("processAdded"),"-"===e.sig.last()||e.bitsize>this.maxsize/this.nb_slots)console.log("[Server:"+t+"] The process named "+e.name+" has been rejected")
else{for(var i,s=0;s<this.nb_slots;s++)if(isNon(this.slots[s])){this.slots[s]=[e.name,e.author,e.description,e.content,e.bitsize],i=s,s=this.nb_slots
break}this.slots[i]!=[e.name,e.author,e.description,e.content,e.bitsize]&&this.nb_slots<this.maxsize&&(this.nb_slots+=this.maxsize/this.nb_slots,this.slots[this.nb_slots]=[e.name,e.author,e.description,e.content,e.bitsize])}this.event=null},this.add=function(t){this.event=new Event("added")
for(var e,i=0;i<this.nb_slots;i++)if(isNon(this.slots[i])||this.slots[i].equals([])){this.slots[i]=JSON.stringify(t),e=i,i=this.nb_slots
break}this.slots[e]!=t&&this.nb_slots<this.maxsize&&(this.nb_slots+=this.maxsize/this.nb_slots,this.slots[this.nb_slots]=JSON.stringify(t)),this.event=null},this.rm=function(t){this.event=new Event("remove"),this.slots[t]=null,this.event=null},this.store=function(){this.event=new Event("storage"),localStorage["server_"+this.name]=JSON.stringify(this),this.event=null},this.update=function(){if(this.event=new Event("update"),localStorage["server_"+this.name]){var t=JSON.parse(localStorage["server_"+this.name])
this.name=t.name,this.admin=t.admin,this.version=t.version,this.maxsize=t.maxsize,this.nb_slots=t.nb_slots,this.slots=t.slots,this.data=new DB(t.data.name,t.data.head,t.data.val,t.data.rows)||t.data}else this.store()
this.event=null},this.fire=function(t){this.event=new Event("fire")
for(var e in this.slots)this.slots.hasOwnProperty(e)&&this.slots[e][0]===t.name&&this.slots[e][1]===t.author&&this.rm(e)
this.event=null},this.reset=function(){this.event=new Event("reset")
for(var t in this.slots)this.slots.hasOwnProperty(t)&&this.rm(t)
this.event=null},this.toString=function(){return"server(name="+this.name+", admin="+this.admin+", type="+this.type+", version="+this.version+", maxsize="+this.maxsize+", slots=["+this.slots.toStr(!0)+"])"},this.on=function(t,e){this.event.type===t&&e(this.event)},Essence.addServer(this),this}function CECheck(t,e,i,s,n){window.defaultStatus="Evalue the connexion and see the downloading speed",e||(e="../img/random2000x2000.jpg"),i||(i=60320),s||(s=100),n||(n=2e4)
var a=new Image
$G.t1=(new Date).getTime(),$G.t2=0,a.src=e+"?t1="+$G.t1,$G.data=a,$e("#"+t).write("Verification in progress..."),setTimeout("CETimer('"+t+"', '"+a+"', 0, "+s+", "+n+", "+i+")",s)}function CETimer(t,e,i,s,n,a){i++,isType(e,"HTMLImageElement")||(e=$G.data),$e("#"+t).write("Verification in progress..."),i*s>=n?$e("#"+t).write(evalDownload(0)):e.complete?($G.t2=(new Date).getTime(),$G.wifi.push((a/($G.t2-$G.t1)).toNDec(3)+"kbps"),$e("#"+t).write(evalDownload(a/($G.t2-$G.t1))),Essence.time("Connexion: "+(a/($G.t2-$G.t1).toNDigits()+" kbps")),window.defaultStatus="normal"):setTimeout("CETimer("+t+", "+e+", "+i+", "+s+", "+n+", "+a+")",s)}function evalDownload(t){var e=""
return e=0===t?"No connexion":t>0&&t<=56?"Low debit":t>56&&t<=8e3?"ADSL debit":t>8e3&&t<=2e4?"ADSL2 + ":t>2e4&&t<=5e4?"wire":t>5e4&&t<=1e5?"optical fibre":"Ethernet",e+" ("+t.toNDigits()+" kbps)"}function evalUpload(t){var e=""
return e=0===t?"No connexion":t>0&&t<=56?"Low debit":t>56&&t<=1e3?"ADSL + ":t>1e3&&t<=5e3?"wire":"Ethernet",e+" ("+t.toNDigits()+" kbps)"}function evalPing(t){var e=""
return e=t>0&&t<=30?"Excellent":t>30&&t<=60?"Really good":t>60&&t<=100?"Good":t>100&&t<=200?"Okay":t>200&&t<=300?"Poor":t>300&&t<=400?"Bad":"Really bad",e+" ("+t+" ms)"}function evalGigue(t){var e,i=(t||$G.wifi).map(function(t){return getNumFromStr(t)}).stddev()
return i>=0&&i<5?e="Synchronized connexion":i>=5&&i<10?e="Slightly synchronized connexion":i>=10&&(e="Asynchronous connexion"),e+" ("+i+")"}function parseURL(t,e){var i=location.href.split("?")
if(i.length>1){var s=i[1].split("&")
if(isType(t,"Array"))for(var n=0;n<t.length;n++)for(var a=0;a<s.length;a++){var o=s[a].split("=")
o[0]===t[n]&&(isType(e,"Array")?e[n](o[1],o[0]):e(o[1],o[0]))}else for(a=0;a<s.length;a++)o=s[a].split("="),o[0]===t&&e(o[1])}}function WebPage(t,e,i,s,n,a,o,r){return this.title=t||"My web page",this.subtitle=r||"A simple web page",this.type=o.normal()||"html",this.name=e+this.type||"index."+this.type,this.path=i+"/"+this.name||this.name,this.author=s||"Maximilian Berkmann",this.version=n||1,this.structure=a||"header!height-menu!content|aside!footer",this.code="",this.template="",this.page=null,this.word2code=function(t){switch(t.normal()){case"header":return"<header><img src='img/icon.png' /><hgroup><h1>{{title}}</h1><h3>{{subtitle}}</h3></hgroup></header>"
case"height-menu":return"<menu class='height-menu'><li onClick=''>{{0}}</li><li onClick=''>{{1}}</li><li onClick=''>{{2}}</li></menu>"
case"v-menu":return"<menu class='v-menu'><li onClick=''>{{0}}</li><li onClick=''>{{1}}</li><li onClick=''>{{2}}</li></menu>"
case"content":return"<div id='content'>{{content}}</div>"
case"aside":return"<aside>{{aside}}</aside>"
case"footer":return"<footer>{{footer}}</footer>"
case"article":return"<article id='{{article_title}}'><header>{{article_title}}</header>{{article_content}}<footer>{{article_footer}}</footer></div>"
case"search":return"<form action='search.php' method='post'><input type='search' name='search' /><input type='image' src='img/search.png' alt='?' /></form>"
default:return t}},this.genTemplate=function(){var t=this.structure.split("!")
this.template="<table class='none'>"
for(var e=0;e<t.length;e++){this.template+="<tr>"
for(var i=t.split("|"),s=0;s<i.length;e++)this.template+=this.word2code(i[e])
this.template+="</tr>"}return this.template+="</table>",this.template},this.genPage=function(t){return this.page=new Template(this.title,this.name,this.template,["title","subtitle","content","aside","footer","0","1","2","article_title","article_content","article_footer"]),this.page=this.page.gen({title:this.title,subtitle:this.subtitle,content:t.content||$G.lorem,aside:t.aside||"At the side",footer:t.footer||"An EssenceJS powered web page",article_content:t.articleContent||"Bla bla bla",article_title:t.articleTitle||"An article",article_footer:t.articleFooter||"By John Doe",0:"Home",1:"About us",2:"Contact us"}),this.page},this}function WebApp(t,e,i,s,n){return this.name=t||"Web App",this.path=e||"",this.author=i||"Maximilian Berkmann",this.version=s||1,this.dirs=["img","script","style"],this.pages=[new WebPage(this.name,"index",this.path,this.author,this.version,n),new WebPage("Contact us","contact",this.path,this.author,this.version,n),new WebPage("About us","about",this.path,this.author,this.version,n)],this.build=function(){for(var t=0;t<this.pages.length;t++)this.pages[t].genPage()},this}function Editor(t,e,i,s,n){return this.id=t||"#editor",this.node=$n(this.id),this.linesId="#lines",this.linesNode=$n(this.linesId),this.nbLines=0,this.language=e||"none",this.previewer=i||null,this.parser=s||(i?this.previewer.associatedParser:null),this.code=$e(this.id).val(),this.codeHistory=new virtualHistory(this.code),this.toolbar=n||new Toolbar,this.toolbar.for=this,this.toggleLine=function(t){$e("#"+t).toggleCSS("background",["rgba(0, 0, 0, 0)","red"])},this.update=function(t){this.node!=$n(this.id)&&(this.node=$n(this.id)),this.linesNode!=$n(this.linesId)&&(this.linesNode=$n(this.linesId)),this.code!=$e(this.id).val()&&(this.code=$e(this.id).val()),t=t||toPixel($e(this.id).css("height"))/(1.12*toPixel($e(this.id).css("fontSize"))),$e(this.linesId).write("",!0),this.nbLines=Math.round(t)
for(var e=1;e<=this.nbLines;e++)$e(this.linesId).after("<span id = 'l_"+e+"' style = 'color: black;'>"+e+"</span><br />")
for(this.codeHistory.update(this.code),this.toolbar.update(),e=0;e<this.toolbar.tools.length;e++)this.toolbar.fn[e]=this[this.toolbar.tools[e]]},this.write=function(t){$e(this.id).after(t),this.codeHistory.update(this.code)},this.clear=function(){$e(this.id).write(""),this.codeHistory.reset()},this.undo=function(){this.codeHistory.undo(),$e(this.id).write(this.codeHistory.src)},this.redo=function(){this.codeHistory.redo(),$e(this.id).write(this.codeHistory.src)},this.save=function(){save($e(this.id).val(),"script"+getTimestamp()+".ws","webscript")},this.select=function(){this.node.select()},this.copy=function(){copyToClipboard($e(this.id).val(),"webscript")},this.paste=function(t){t?$e(this.id).write(clipboardData.getData("webscript")):this.write(clipboardData.getData("webscript"))},this.load=function(){var t=prompt("File: ",".ws")
this.clear(),$e(this.id).write(getFileContent(t))},this.generate=function(){this.previewer?/<\?php([\s\S]*?)\?>/.test($e(this.id).val())?save($e(this.previewer.id).val(!0),"script"+getTimestamp()+".php","php"):save($e(this.previewer.id).val(!0),"script"+getTimestamp()+".html","html"):/<\?php([\s\S]*?)\?>$/g.test($e(this.id).val())?save($e("#preview").val(!0),"script"+getTimestamp()+".php","php"):save($e(i.id).val(!0),"script"+getTimestamp()+".html","html")},this.view=function(){this.previewer.run($e(this.id).val(),!0)},this.highlightSyntax=function(t,e){switch(e.normal()){case"html":break
case"javascript":break
case"css":break
case"php":break
case"mips":break
case"batch":break
case"bash":break
case"java":break
case"c++":break
case"python":break
case"xml":break
case"webscript":t=t.replace(/(<|>|\/\>)([A-Za-z]*|)(<|>|\/>)/g,"<span class = 'code-tag'>$1</span>"),t=t.replace(/("|')(.*)("|')/g,"<span class = 'code-str'>$1</span>"),t=t.replace(/(?!"|')(\d+)(?!"|')/g,"<span class = 'code-num'>$1</span>"),t=t.replace(/([\s\S] * ?)(=)/g,"<span class = 'code-attr'>$1</span>"),t=t.replace(/<!--([\s\S]*)--\>/g,"<span class = 'code-cmt'>$1</span>"),t=t.replace(/\/\/(.*?)/g,"<span class = 'code-cmt'>$1</span>"),t=t.replace(/=[A-Za-z0-9.]+(| )/g,"<span class = 'code-val'>$1</span>"),t=t.replace(/[={}\[\]();]/g,"<span class = 'code-op'>$1</span>")
break
case"markdown":}return t},this.toString=function(){return"Editor(id="+this.id+", linesId="+this.linesId+", nbLines="+this.nbLines+", language="+this.language+", previewer="+this.previewer+", parser="+this.parser+", code="+this.code+", toolbar="+this.toolbar+")"},this}function Preview(t,e,i,s){return this.id=t||"#preview",this.node=$n(this.id),this.language=e||"none",this.associatedParser=i||new Parser,this.associatedEditor=s||new Editor,this.update=function(){this.node!=$n(this.id)&&(this.node=$n(this.id))},this.run=function(t,e){$e(this.id).write(e?this.associatedParser.run(t):t,!0)},this.viewCode=function(){var t=open("","Resulting code","width = 800,height = 600,location = no,menubar = yes,scrollbars = yes,status = no,toolbar = yes"),e=escapeHTML($e(this.id).val(!0))
e=e.replace(/\n/g,"<br />"),e=e.replace(/\t/g,"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"),t.document.write(this.associatedEditor.highlightsyntax(e,this.language)),t.document.write("<style>"+Essence.css+"</style>")},this.toString=function(){return"Preview(id="+this.id+", language="+this.language+", associatedParser="+this.associatedParser+", associatedEditor="+this.associatedEditor+")"},this}function Debugger(t,e){return this.id=t||"#debugger",this.node=$n(this.id),this.language=e||"none",this.update=function(){this.node!=$n(this.id)&&(this.node=$n(this.id))},this.run=function(t){},this.toString=function(){return"Debugger(id="+this.id+", language="+this.language+")"},this}function Parser(t,e,i){this.from=t||"WebScript",this.to=e||"DHTML",this.run=i||function(t){var e=t
return e=e.replace(/<tab \/>/gm,"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"),e=e.replace(/\{\{tab}}/gm,"\t"),e=e.replace(/<info>(.*?)<\/info>/gm,"<span class='block info'>$1</span>"),e=e.replace(/<question>(.*?)<\/question>/gm,"<span class='block question'>$1</span>"),e=e.replace(/<error>(.*?)<\/error>/gm,"<span class='block error'>$1</span>"),e=e.replace(/<warning>(.*?)<\/warning>/gm,"<span class='block warning'>$1</span>"),e=e.replace(/<success>(.*?)<\/success>/gm,"<span class='block success'>$1</span>"),e=e.replace(/(\{\{)LOREM(}})/gi,$G.lorem),e=e.replace(/(?:\{\{)LOREM\x7c(\d+)-(\d+)(?:}})/gi,$G.lorem.chunk("$1","$2")),e=e.replace(/(?:\{\{)HW(?:}})/gi,"Hello World !"),e=e.replace(/<icon \/>/gm,"<img src='img/icon.png' class='icon'/>"),e=e.replace(/<icon size=(?:"|')(\w+)(?:"|') \/>/gm,"<img src='img/icon.png' class='icon' style='width: $1px; height: $1px;' />"),e=e.replace(/<icon name=(?:"|')(\w+)(?:"|') \/>/gm,"<img src='img/$1.png' class='icon' />"),e=e.replace(/<(s|m|l|xs|xl):icon name=(?:\"|\')(\w+)(?:\"|\') \/>/gm,"<img src='img/$2.png' class='$1-icon' />"),e=e.replace(/<js>([\s\S]*?)<\/js>/gm,"<script type='text/javascript'>$1</script>"),e=e.replace(/<js src=(?:\"|\')(\w+)(?:\"|\') \/>/gm,"<script type='text/javascript' src='$1'></script>"),e=e.replace(/<vb>([\s\S]*?)<\/vb>/gm,"<script type='text/vbscript'>$1</script>"),e=e.replace(/<vb src=(?:\"|\')(\w+)(?:\"|\') \/>/gm,"<script type = 'text/vbscript' src='$1'></script>"),e=e.replace(/<css>([\s\S]*?)<\/css>/gm,"<style type='text/css'>$1</style>"),e=e.replace(/<css href=(?:\"|\')([A-Za-z_ -\.]+)(?:\"|\') \/>/gm,"<link rel='stylesheet' type='text/css' href='$1' />"),e=e.replace(/<charset=(?:\"|\')(\w + )(?:\"|\') \/>/gm,"<meta charset='$1' />"),e=e.replace(/<author name=(?:\"|\')(\w + )(?:\"|\') href=(?:\"|\')(\w+)(?:\"|\') \/>/gm,"<meta name='author' content='$1' /><link rel='author' href='$2' />"),e=e.replace(/<desc>(.*?)<\/desc>/gm,"<meta name='description' content='$1' />"),e=e.replace(/<copy>(.*?)<\/copy>/gm,"<meta name='copyrights' content='$1' />"),e=e.replace(/<lbl>(.*?)<\/lbl>/gm,"<label>$1</label>"),e=e.replace(/<submit \/>/gm,"<input type='submit' />"),e=e.replace(/<submit val=(?:\"|\')(\w+)(?:\"|\') \/>/gm,"<input type='submit' value='$1' />"),e=e.replace(/<reset \/>/gm,"<input type='reset' />"),e=e.replace(/<reset val=(?:\"|\')(\w+)(?:\"|\') \/>/gm,"<input type='reset' value = '$1' />"),e=e.replace(/<hdn name=(?:\"|\')(\w+)(?:\"|\')>(.*?)<\/hdn>/gm,"<input type='hidden' name='$1' value='$2' />"),e=e.replace(/<hdn name=(?:\"|\')(\w+)(?:\"|\') id=(?:\"|\')(\w+)(?:\"|\')>(.*?)<\/hdn>/gm,"<input type='hidden' name='$1' value='$3' id='$2' />"),e=e.replace(/<txt ((?:id|name|class)(\=(?:\"|\')(\w+)(?:\"|\'))(| ))\/>/gm,"<input type='text' />"),e=e.replace(/<sql query=(?:\"|\')(.*?)(?:\"|\') \/>/gm,"<?php\n\tif (mysqli_ping($$dbc)) {\n\t\t$r = mysqli_query($$dbc, '$1');\n\t}else printMsg('error', 'No ping');\n?>"),e=e.replace(/<sqlt table=(?:\"|\')(\w+)(?:\"|\') query=(?:\"|\')(.*?)(?:\"|\') \/>/gm,"<?php\n\tif (mysqli_ping($$dbc)) {\n\t\techo 'Last updated at '._time().\"<br />\";selectTable($dbc, '$1', '$2');\n\t}else printMsg('error', 'No ping');\n?>")},this.toString=function(){return"Parser("+this.from+"->"+this.to+")"}}function Toolbar(t,e,i){return this.id=t||"#toolbar",this.node=$n(this.id),this.tools=e||["undo","redo","clear","save","select","copy","paste","load","generate","view"],this.fn=[],this.for=i||null,this.update=function(){this.node!=$n(this.id)&&(this.node=$n(this.id))
for(var t=0;t<this.tools.length;t++)this.fn[t]=this.for[this.tools[t]]},this.toString=function(){return"Toolbar(id="+this.id+", tools="+this.tools.toStr(!0)+", fn="+this.fn+", for="+this.for+")"},this}function IDE(t,e,i,s,n,a){return this.editor=e||new Editor,this.parser=s||new Parser,this.preview=i||new Preview,this.preview.associatedParser=this.parser,this.editor.previewer=this.preview,this.editor.parser=this.parser,this.debugger=n||new Debugger,this.language=t||"none",this.init=function(t,e){"none"!=this.language&&(e?this.editor.language=this.debugger.language=this.parser.from=this.language=e:this.editor.language=this.debugger.language=this.parser.from=this.language),t&&(this.parser.to=t,this.preview.language=t)},this.toolbar=a||this.editor.toolbar,this.update=function(t){this.editor.update(t),this.preview.update(),this.debugger.update()},this.toString=function(){return"IDE(editor="+this.editor+", parser="+this.parser+", preview="+this.preview+", debugger="+this.debugger+", language="+this.language+")"},this}function loadBar(t,e,i){t||(t="#lb"),Essence.addCSS(t+" {border: none;background: #0F0;max-width: 200px;text-align: center;font-size: 28px;padding: 2px;}#bar {border: 1px ridge #CCC;text-align: center;width: 201px;});"),i||(i=30),$e(t).setCSS("position","relative"),$e(t).setCSS("width",$e(t).css("width")+$G.i),$e(t).write($G.i+"%"),$G.i++,$G.timer=setTimeout("loadBar("+t+", "+e+", "+i+")",i),$G.i>=100&&(clearTimeout($G.timer),$G.i=0,$e(t).write("Loading finished"),e())}function Console(title,entry,usr){return this.title=title||"Console",this.val=entry||"",this.history=new virtualHistory(this.val),this.user=usr||"User",this.exec=function(ins){"/"!=ins[0]?this.out("<span class='error'>Invalid command</span>"):this.val=ins,this.history.add(ins)
var cmd=ins.split(" ")[0].get(1).toLowerCase(),params=ins.split(" ").get(1)
switch(cmd){case"say":this.out(params.join(" "),"&lt"+this.user+"&gt;")
break
case"help":this.out("<b>Help: </b><br />/say [text]"+tabs()+"Let the user say something on the console<br />/help"+tabs()+"Show this<br />/reload"+tabs()+"Reload the console<br />/title [title]"+tabs()+"/$"+tabs()+"Display EssenceJS'start version<br />/exp [...]"+tabs()+"Evaluate an expression")
break
case"reload":this.val="",$e("#consoleOut").write("")
break
case"title":$e("#consoleTitle").write(params.join(" "))
break
case"$":this.out("Essence v"+Essence.version)
break
case"exp":this.out(eval(params.join(" ")),"$EXP&gt;")
break
default:this.exec("/help")}},this.html="<table id='console' cellpadding=0 cellspacing=0><thead><th id='consoleTitle'>"+this.title+"</th></thead><tr><td><span id='consoleOut'>"+this.val+"</span></td></tr><tr><td><input id='consoleIn' /></td></tr></table>",this.out=function(t,e){$e("#consoleOut").after((e?"<span style='color: #0f0'>"+e+"</span> ":"")+t+"<br />",!0)},this.place=function(t){$e(t?"#"+t:"body").write(this.html,!0)},this.init=function(t){this.place(t||"console"),$n("#consoleOut").innerHTML=(this.val||"Hello world !")+"<br/>"
var e=this
$e("#consoleIn").on("change",function(){e.exec(this.value),this.value=""})},this}function getIP(){var t={},e=new CORS("http://api.ipify.org?format=jsonp&callback=_","GET",!1,function(e){return t=JSON.parse(e.response.replace(/_\((.*?)\);/,"$1")),$G.IP=t.ip,t},function(){Essence.say("IP gathering failed !","warn")},$f)
return e.silence(),e.init(),t.ip||$G.IP}function getPrivateIP(){function t(t){s[t]||($G.privateIP=t),s[t]=!0}var e=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection,i=new e({iceServers:[]}),s={},n=/([0-9]{1,3}(\.[0-9]{1,3}){3}|[a-f0-9]{1,4}(:[a-f0-9]{1,4}){7})/g
return i.createDataChannel(""),i.createOffer(function(e){e.sdp.split("\n").forEach(function(e){e.indexOf("candidate")<0||e.match(n).forEach(t)}),i.setLocalDescription(e,$f,$f)},$f),i.onicecandidate=function(e){e&&e.candidate&&e.candidate.candidate&&e.candidate.candidate.match(n)&&e.candidate.candidate.match(n).forEach(t)},$G.privateIP}var Web=new Module("Web","Web stuff",["DataStruct","Misc"],1,function(){}),CookieHistory={get:function(){return document.cookie.split(";").map(function(t){return t.split("=")[0]}).remove("CookieHistory",!0)},set:function(){setCookie("CookieHistory",this.get())},toObject:function(){return Objectify(this.get(),document.cookie.split(";").filter(function(t){return"CookieHistory"!=t.split("=")[0]}).map(function(t){return t.split("=")[1]}))}}
$G.data=null,$G.wifi=[]
var WifiTest={down:0,up:0,ping:0,gigues:[0,0],type:"",vals:[],imgs:[{dim:350,size:1912},{dim:500,size:3944},{dim:750,size:8480},{dim:1e3,size:15120},{dim:1500,size:34080},{dim:2e3,size:60320},{dim:2500,size:94400},{dim:3e3,size:135200},{dim:3500,size:184800},{dim:4e3,size:240800}],elm:$e("#wifi",!0)||$e("#wifitest",!0)||$e("#test",!0),test:function(){return this.testUp(),this.testDown(),this.testPing(),"Ping/Up/Down/Gigue up/Gigue down: "+[this.ping,this.up,this.down,this.gigues[0],this.gigues[1]].join("/")},testUp:function(){return this.vals=$G.wifi,$G.wifi=[],this.type=evalUpload(this.up).split(" ")[0],this.gigues[0]=parseFloat(evalGigue(this.vals).split(" ")[0]),this.up+" Ko/start"},testDown:function(){for(var t=this.elm.val(),e=0;e<this.imgs;){for(CECheck(this.elm.node.id,"../img/random"+this.imgs[e].dim+"x"+this.imgs[e].dim+".jpg",this.imgs[e].size);this.elm.val()===t||"normal"!=window.defaultStatus;);this.elm.val()==t&&"normal"!==window.defaultStatus||e++}return this.vals=$G.wifi,$G.wifi=[],this.down=(this.vals.map(function(t){return getNumFromStr(t)}).mean(2)/8).toNDec(2),this.type=evalDownload(this.down).split(" ")[0],this.gigues[1]=parseFloat(evalGigue(this.vals).split(" ")[0]),this.down+" Ko/start"},testPing:function(){return this.type=evalPing(this.ping).split(" ")[0],this.ping+"ms"}}
$G.i=0

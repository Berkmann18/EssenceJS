function GET(e){if(new RegExp("[?&]"+encodeURIComponent(e)+"=([^&]*)").exec(location.search))return decodeURIComponent(new RegExp("[?&]"+encodeURIComponent(e)+"=([^&]*)").exec(location.search)[1])}function POST(e,t){var s=document.createElement("form")
s.setAttribute("method","post"),s.setAttribute("action",e)
for(var r in t)if(t.hasOwnProperty(r)){var n=document.createElement("input")
n.setAttribute("type","hidden"),n.setAttribute("name",r),n.setAttribute("value",t[r]),s.appendChild(n)}document.body.appendChild(s),s.submit()}function PUT(){}function DELETE(){}function load(e,t){var s=new XHR(e,"get",!0,t)
s.init()}function loadJSON(e){var t=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP")
t.overrideMimeType("application/json"),t.open("GET",(e||"data")+".json",!0),t.onreadystatechange=function(){4===t.readyState&&200===t.status&&function(){return $G.json=JSON.parse(t.responseText),JSON.parse(t.responseText)||$G.json}()},t.send(null)
try{return JSON.parse(t.response)}catch(e){return $G.json}}function XHR(e,t,s,r,n,o,i,a,c){this.url=e||location.href,this.method=t||"GET",this.response=null,this.credentials=a||["",""],this.async=s||!1,this.req=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),this.forIE=!window.XMLHttpRequest,this.state=getXHRMsg(0),this.status=this.req.status,this.body=i||""
var u=this
return this.req.onreadystatechange=function(){u.state=getXHRMsg(u.req.readyState),u.handleResponse(),u.status!=u.req.status&&(u.status=u.req.status),4!==u.req.readyState||200!==u.req.status&&204!==u.req.status?3===u.req.readyState?u.onLoad(this):u.req.status>=400&&u.req.status<=505&&u.onFailure(this):u.onSuccess(this)},this.onChange=this.req.onreadystatechange,this.onSuccess=r||function(){u.handleResponse(),console.log("%c[XHR] %s%c:\n%s","color: #0f0",u.status+" "+getHTTPMsg(u.status),"color: #000;",u.response)},this.onFailure=n||function(){u.handleResponse(),console.log("%c[XHR] %s%c:\n%s","color: #f00",u.status+" "+getHTTPMsg(u.status),"color: #000;",u.response)},this.onLoad=o||function(){u.handleResponse(),console.log("%c[XHR] %s%c:\n%s","color: #666",u.state,"color: #000;",u.status+" "+getHTTPMsg(u.status))},this.req.onload=function(){console.info("%c[XHR]%c Loading the %s request to %s","color: #666;","color: #000;",u.method,u.url)},this.req.onerror=function(){console.error("%c[XHR]%c There was an error in the request !","color: #f00","color: #000")},this.handleResponse=function(){switch(this.req.responseType){case"":case"text":this.response=this.req.responseText
break
case"json":this.response=this.req.responseXML
break
default:this.response=this.req.response}},this.init=function(e){c&&this.req.overrideMimeType(c),this.req.open(this.method,this.url,this.async,this.credentials[0],this.credentials[1]),this.header("Access-Control-Allow-Origin",getDirectoryPath(this.url)+", "+getDirectoryPath())
var t=[this.method]
"GET"!=this.method&&t.push("GET"),"POST"!=this.method&&t.push("POST"),this.header("Access-Control-Allow-Methods",t.toStr(!0)),this.header("Access-Control-Allow-Max-Age","1728000"),""!=this.credentials[0]&&""!=this.credentials[1]&&(this.req.withCredentials=!0,this.header("Access-Control-Allow-Credentials","true")),"POST"!==this.method&&"DELETE"!==this.method||this.header("Body",this.body),this.onChange(),e&&e.map(function(e){u.header(e[0],e[1])}),this.req.send(isNon(this.body)?this.response:this.body)},this.header=function(e,t){return t?void this.req.setRequestHeader(e,t):e?this.req.getResponseHeader(e):this.req.getAllResponseHeaders()},this.toString=function(){return"XHR(url='"+this.url+"', method='"+this.method+"', response='"+this.response+"', credentials="+this.credentials+", async="+this.async+", state='"+this.state+"', status="+this.status+", forIE="+this.forIE+", body='"+this.body+"')"},this.viewResponse=function(e){this.handleResponse(),$e(e?"#"+e:"body").write(this.response,!0)},this}function CORS(e,t,s,r,n,o,i,a,c){var u=this
this.xhr=new XHR(e,t,s||!0,r||function(){this.handleResponse(),u.update(),console.log("%c[CORS] %s%c:\n%s","color: #0f0",this.status+" "+getHTTPMsg(this.status),"color: #000;",u.response)},n||function(){this.handleResponse(),u.update(),console.log("%c[CORS] %s%c:\n%s","color: #f00",this.status+" "+getHTTPMsg(this.status),"color: #000;",u.response)},o||function(){this.handleResponse(),u.update(),console.log("%c[CORS] %s%c:\n%s","color: #666",this.status+" "+getHTTPMsg(this.status),"color: #000;",thisself.response)},i,a,c)
try{"withCredentials"in this.xhr.req||"undefined"==typeof XDomainRequest||(this.xhr.req=new XDomainRequest)}catch(e){}return this.init=function(){this.xhr.init([["Access-Control-Request-Headers","X-Custom-Header"],["Access-Control-Allow-Headers","Cache-Control, Content-Language, Content-Type, Expires, Last-Modified, Pragma, Body, Origin, X-Custom-Headers, X-PINGOTHER"],["Access-Control-Expose-Headers","X-Custom-Header"]]),this.update()},this.response=this.xhr.response,this.url=this.xhr.url,this.method=this.xhr.method,this.body=i||"",this.forIE="undefined"!=typeof XDomainRequest,this.toString=function(){return"CORS(url="+this.url+", method="+this.method+", body="+this.body+", forIE="+this.forIE+", response="+this.response+", xhr="+this.xhr.toString()+")"},this.update=function(){this.xhr.handleResponse(),this.response=this.xhr.response,this.url=this.xhr.url,this.method=this.xhr.method,isNon(this.body)&&(this.body=this.xhr.body)},this.silence=function(){this.xhr.req.onerror=$f},this}function AJAXpost(e,t,s){var r=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),n=""
return r.onreadystatechange=function(){4===r.readyState&&200===r.status&&(n=s?r.responseXML:r.responseText)},r.open("POST",t,!0),s?(r.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),r.send(e)):(r.setRequestHeader("Content-Type","text/plain"),r.send(e)),n}function getHTTPMsg(e){switch(e){case 100:return"Continue"
case 101:return"Switching Protocols"
case 200:return"OK"
case 201:return"Created"
case 202:return"Accepted"
case 203:return"Non-Authoriative Information"
case 204:return"No Content"
case 205:return"Reset Content"
case 206:return"Partial Content"
case 300:return"Multiple Choices"
case 301:return"Moved Permanently"
case 302:return"Found"
case 303:return"See Other"
case 304:return"Not Modified"
case 305:return"Use Proxy"
case 306:return"Unused"
case 307:return"Temporary Redirect"
case 400:return"Bad Request"
case 401:return"Unauthorized"
case 402:return"Payment Required"
case 403:return"Forbidden"
case 404:return"Not Found"
case 405:return"Method Not Allowed"
case 406:return"Not Acceptable"
case 407:return"Proxy Authentication Required"
case 408:return"Request Timeout"
case 409:return"Conflict"
case 410:return"Gone"
case 411:return"Length Required"
case 412:return"Precondition Failed"
case 413:return"Request Entity Too Large"
case 414:return"Request-url Too Long"
case 415:return"Bad Request"
case 416:return"Unsupported Media Type"
case 417:return"Expectation Failed"
case 500:return"Internal Server Error"
case 501:return"Not Implemented"
case 502:return"Bad Gateway"
case 503:return"Service Unavailable"
case 504:return"Gateway Timeout"
case 505:return"HTTP Version Not Supported"
default:return"Unknown status"}}function getXHRMsg(e){return["UNSENT","OPENED","HEADERS_RECEIVED","LOADING","DONE"][e]}function createCORSRequest(e,t){var s=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP")
return"withCredentials"in s||void 0!==s.withCredentials?s.open(e||"get",t||getDirectoryPath(),!0):"undefined"!=typeof XDomainRequest||XDomainRequest?(s=new XDomainRequest,s.open(e||"GET",t||getDirectoryPath())):s=null,s}function setCORS(e,t,s,r,n){var o=null,i=createCORSRequest(t,e||getDirectoryPath())
if(!i)throw new Error("CORS not supported.")
return r&&(i.withCredentials=!0,i.setRequestHeader("Access-Control-Allow-Credentials","true")),i.setRequestHeader("Access-Control-Allow-Origin",getDirectoryPath()),i.setRequestHeader("Access-Control-Allow-Methods","GET, POST, PUT, DELETE"),i.setRequestHeader("Access-Control-Allow-Headers","Cache-Control, Content-Language, Content-Type, Expires, Last-Modified, Pragma, Body, Origin"),i.setRequestHeader("Access-Control-Request-Headers","X-Custom-Header"),i.setRequestHeader("Access-Control-Allow-Max-Age","1728000"),i.onload=function(){o=s?i.responseXML:i.responseText},i.onreadystatechange=function(){4===i.readyState&&200===i.status&&(o=s?i.responseXML:i.responseText)},i.onerror=function(){Essence.say("There was an error in the CORS request","erro")},n?i.send(n):i.send(),o}var Ajax=new Module("Ajax","AJAX stuff")
